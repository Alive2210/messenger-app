# TURN/STUN Server Configuration for WebRTC
# Работает через VPN и NAT без потерь качества

# Listener IP address
listening-ip=0.0.0.0
listening-port=3478

# Relay IPs (должны быть доступны всем клиентам в VPN)
relay-ip=${TURN_RELAY_IP:-0.0.0.0}
external-ip=${TURN_EXTERNAL_IP:-0.0.0.0}

# TLS/DTLS
listening-port=3478
tls-listening-port=5349
dtls-listening-port=5349

# Certificates (для продакшена заменить на реальные)
cert=/etc/coturn/certs/server.crt
pkey=/etc/coturn/certs/server.key

# Authentication
fingerprint
lt-cred-mech
realm=${TURN_REALM:-messenger.local}
server-name=${TURN_SERVER_NAME:-turn.messenger.local}

# Users
user=${TURN_USER:-messenger}:${TURN_PASS:-secure_password_123}

# Безопасность
no-cli
no-tlsv1
no-tlsv1_1
cipher-list="ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384"

# Производительность
max-bps=0
bps-capacity=0

# Время жизни сессии (долгое для видеоконференций)
max-allocate-lifetime=3600
default-allocate-lifetime=600

# Лимиты
max-allocations-per-user=50
max-allocations-per-relay=1000

# Режим без потерь - максимальное качество
# Включаем UDP relay для работы без статического IP
allow-udp-relay
allow-tcp-relay

# Включаем UDP для лучшей производительности
udp-self-balance

# Настройки для работы без статического IP
# Автоматическое определение external IP
external-ip=${TURN_EXTERNAL_IP:-${TURN_RELAY_IP:-0.0.0.0}}

# Логирование
log-file=/var/log/coturn/turnserver.log
verbose
