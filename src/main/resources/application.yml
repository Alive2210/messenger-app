server:
  port: 8080

spring:
  application:
    name: secure-messenger
  
  datasource:
    url: jdbc:postgresql://localhost:5432/messenger_db
    username: ${DB_USERNAME:messenger_user}
    password: ${DB_PASSWORD:messenger_pass}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true

  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-master.xml

  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USER:guest}
    password: ${RABBITMQ_PASS:guest}
    listener:
      simple:
        concurrency: 5
        max-concurrency: 20
        prefetch: 50

  servlet:
    multipart:
      enabled: true
      max-file-size: 100MB
      max-request-size: 100MB

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:your-256-bit-secret-key-here-must-be-at-least-32-characters}
  expiration: 86400000 # 24 hours in milliseconds
  refresh-expiration: 604800000 # 7 days

# MinIO Configuration
minio:
  endpoint: ${MINIO_ENDPOINT:http://localhost:9000}
  access-key: ${MINIO_ACCESS_KEY:minioadmin}
  secret-key: ${MINIO_SECRET_KEY:minioadmin}
  bucket-name: messenger-files

# Encryption
encryption:
  signal:
    enabled: true

# WebSocket
websocket:
  endpoint: /ws
  allowed-origins: "*"

# Video Conference
webrtc:
  ice-servers:
    - url: stun:stun.l.google.com:19302
    - url: stun:stun1.l.google.com:19302
  turn-server:
    enabled: false

# Logging
logging:
  level:
    com.messenger: DEBUG
    org.springframework.security: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Device Management
device:
  heartbeat:
    timeout: 2 # Minutes without heartbeat before marking device as offline (reduced for 10s checks)
    interval: 10 # Expected heartbeat interval in seconds
  settings:
    max-devices-per-user: 10
    allow-multiple-devices: true

# Application URLs for QR codes
app:
  server:
    url: ${SERVER_URL:http://localhost:8080}
  websocket:
    url: ${WEBSOCKET_URL:/ws}

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

# VAPID keys for push notifications (placeholder values)
vapid:
  public-key: BEl62iUYgUivxIkv69yViEuiBIa-Ib9-SkvMeAtA3LFgDzkrxZJjSgSnfckjBJuBkr3qBUYIHBQFLXYp5Nksh8U
  private-key: UUxI4O8-FbRouAf7-7OT9lYq3Z9t3kU5jK8nV7wX2yA
  subject: mailto:admin@example.com
